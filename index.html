<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Tool Ve Chai V1</title>

<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

<style>
*{box-sizing:border-box}

body{
  font-family:Arial;
  background:#0b0f19;
  color:white;
  margin:0;
}

/* ===== MAIN CONTAINER ===== */
.main-wrap{
  padding:20px;
  max-width:1000px;
  margin:auto;
}

/* ===== SEARCH ===== */
.search-box{
  display:flex;
  gap:10px;
  margin-top:15px;
}

.search-box input{
  flex:1;
  padding:14px;
  border-radius:12px;
  border:1px solid #1f2937;
  background:#111827;
  color:white;
  font-size:15px;
}

.search-box button{
  padding:0 25px;
  border-radius:12px;
  border:none;
  background:linear-gradient(90deg,#2563eb,#3b82f6);
  color:white;
  font-weight:bold;
  cursor:pointer;
  transition:0.2s;
}

.search-box button:hover{
  transform:scale(1.05);
}

/* ===== RESULT GRID ===== */
.result-grid{
  display:grid;
  gap:20px;
  margin-top:20px;
  grid-template-columns:repeat(2,1fr);
}

@media(max-width:768px){
  .result-grid{
    grid-template-columns:1fr;
  }
}

.result-card{
  background:linear-gradient(145deg,#111827,#1f2937);
  border-radius:18px;
  padding:18px;
  border:1px solid #1f2937;
  transition:0.25s;
}

.result-card:hover{
  transform:translateY(-5px);
  border-color:#2563eb;
  box-shadow:0 0 20px rgba(37,99,235,0.3);
}

.vip-badge{
  padding:6px 14px;
  border-radius:999px;
  font-weight:700;
  font-size:13px;
}

.vip-8{ background:linear-gradient(90deg,#6d28d9,#a855f7); }
.vip-9{ background:linear-gradient(90deg,#06b6d4,#0ea5e9); }
.vip-10{ background:linear-gradient(90deg,#FFD700,#ffcc00,#FFD700); color:black; }
.vip-11{ background:linear-gradient(90deg,#ff4d00,#ff0000); }
.vip-13{ background:linear-gradient(90deg,#5b0000,#ff0000,#5b0000); }

.loading{
  text-align:center;
  margin-top:20px;
  color:#facc15;
}

/* ===== ADMIN LINK CARD ===== */
.link-card{
  background:#141414;
  border:1px solid #222;
  border-radius:14px;
  padding:14px 18px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:12px;
  transition:0.2s;
}

.link-card:hover{
  border-color:#2563eb;
}
</style>
</head>

<body>

<!-- LOGIN SCREEN -->
<div id="loginScreen" style="position:fixed;inset:0;background:#000;display:flex;justify-content:center;align-items:center;z-index:9999;">
  <div style="width:360px;background:#111;padding:30px;border-radius:20px;border:1px solid gold;">
    <h2 style="text-align:center;color:gold;">üîê Tool Ve Chai Admin</h2>
    <input id="loginEmail" type="email" placeholder="Nh·∫≠p Gmail"
    style="margin-top:15px;width:100%;padding:12px;border-radius:10px;border:none;background:#222;color:white;">
    <input id="loginPass" type="password" placeholder="Nh·∫≠p Password"
    style="margin-top:10px;width:100%;padding:12px;border-radius:10px;border:none;background:#222;color:white;">
    <button onclick="secureLogin()" 
    style="margin-top:15px;width:100%;padding:12px;border-radius:10px;background:gold;font-weight:bold;">
      LOGIN
    </button>
    <div id="loginError" style="color:red;text-align:center;margin-top:10px;"></div>
  </div>
</div>

<div class="main-wrap">
  <h2>üõ† Tool Ve Chai Check VIP</h2>

  <div class="search-box">
    <input id="q" placeholder="Nh·∫≠p m√£ c·∫ßn ki·ªÉm tra">
    <button onclick="check()">CHECK</button>
  </div>

  <!-- ADMIN PANEL -->
  <div id="adminPanel" style="display:none;margin-top:30px;">
    <hr style="margin:20px 0;">
    <h3>üîó Qu·∫£n l√Ω Link</h3>

    <button onclick="createLink()"
      style="width:100%;padding:12px;border-radius:10px;background:#16a34a;color:white;">
      ‚ûï T·∫°o link m·ªõi
    </button>

    <div id="linkList" style="margin-top:15px;"></div>
  </div>

  <div id="out" style="margin-top:20px;"></div>
</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCEL7BDXvmNi2dp1VNpua7b2plpTiTOK3U",
  authDomain: "toolvechai.firebaseapp.com",
  projectId: "toolvechai"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

/* üî• QUAN TR·ªåNG: d√πng LOCAL ƒë·ªÉ kh√¥ng l·ªói login */
auth.setPersistence(firebase.auth.Auth.Persistence.LOCAL);

function secureLogin(){
  const email = document.getElementById("loginEmail").value.trim();
  const pass = document.getElementById("loginPass").value.trim();

  auth.signInWithEmailAndPassword(email, pass)
    .catch(()=>{
      document.getElementById("loginError").innerText = "Sai Gmail ho·∫∑c Password!";
    });
}

auth.onAuthStateChanged(async user=>{
  if(!user) return;

  try{
    const doc = await db.collection("users").doc(user.email).get();
    if(!doc.exists || doc.data().role !== "admin"){
      alert("B·∫°n kh√¥ng c√≥ quy·ªÅn admin!");
      auth.signOut();
      return;
    }

    document.getElementById("loginScreen").remove();
    document.getElementById("adminPanel").style.display="block";
    loadLinks();
  }catch(e){
    alert("L·ªói ph√¢n quy·ªÅn");
  }
});

async function check(){
  const key = document.getElementById("q").value.trim().toUpperCase();
  const out = document.getElementById("out");
  if(!key) return;

  out.innerHTML=`<div class="loading">üîé ƒêang qu√©t...</div>`;

  const snap = await db.collection("codes").get();
  let html='<div class="result-grid">';
  let found=false;

  snap.forEach(doc=>{
    const x=doc.data();
    if((x.code||"").toUpperCase().includes(key)){
      found=true;
      html+=`
        <div class="result-card">
          <div style="font-size:18px;font-weight:600;margin-bottom:8px;">
            ‚ö° ${x.code}
          </div>
          <span class="vip-badge vip-${x.vip}">
            üëë ${x.vip}
          </span>
        </div>
      `;
    }
  });

  html+="</div>";
  out.innerHTML=found?html:"<div style='color:red;margin-top:15px;'>‚ùå Kh√¥ng t√¨m th·∫•y m√£</div>";
}

async function createLink(){
  const id = Date.now().toString(36);
  await db.collection("shareLinks").doc(id).set({
    active:true,
    createdAt:firebase.firestore.FieldValue.serverTimestamp()
  });
  loadLinks();
}

async function loadLinks(){
  const snap = await db.collection("shareLinks").get();
  let html="";
  snap.forEach(doc=>{
    const d=doc.data();
    html+=`
      <div class="link-card">
        <div>${doc.id}</div>
        <div>${d.active?'üü¢':'üîí'}</div>
      </div>
    `;
  });
  document.getElementById("linkList").innerHTML=html;
}
</script>

</body>
</html>
