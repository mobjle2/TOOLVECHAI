<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>CHECK VIP</title>

<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

<style>

body{
  font-family:Arial;
  background:#111;
  color:white;
}
.item{
  background:#1a1a1a;
  padding:15px;
  margin-bottom:10px;
  border-radius:10px;
}
.badge{
  display:inline-block;
  padding:4px 10px;
  border-radius:20px;
  font-size:12px;
  margin-top:5px;
}

/* ====== THÃŠM Tá»ª ÄÃ‚Y ====== */

@media(min-width:900px){
  #out{
    grid-template-columns:repeat(3,1fr) !important;
  }
}

.mmc-badge{
  background:linear-gradient(90deg,#1fb6ff,#0ea5e9);
  color:white;
}

.vip-8{
  background:linear-gradient(90deg,#7c3aed,#a855f7);
  color:white;
  box-shadow:0 0 20px rgba(168,85,247,0.7);
}

.vip-9{
  background:linear-gradient(90deg,#06b6d4,#0ea5e9);
  color:white;
  box-shadow:0 0 20px rgba(14,165,233,0.7);
}

.vip-10{
  background:linear-gradient(90deg,#FFD700,#ffcc00);
  color:black;
  box-shadow:0 0 25px rgba(255,215,0,0.9);
}

/* ===== THÃŠM VIP CÃ’N THIáº¾U á» ÄÃ‚Y ===== */

.vip-5{
  background:#facc15;
  color:black;
}

.vip-6{
  background:linear-gradient(90deg,#facc15,#fb923c);
  color:black;
}

.vip-7{
  background:linear-gradient(90deg,#fb923c,#ef4444);
  color:white;
}

.vip-11{
  background:linear-gradient(90deg,#ff4d00,#ff0000);
  color:white;
}

.vip-12{
  background:linear-gradient(90deg,#ff0000,#990000);
  color:white;
}

.vip-13{
  background:linear-gradient(90deg,#5b0000,#ff0000,#5b0000);
  color:white;
}

/* ===== Háº¾T PHáº¦N THÃŠM ===== */


</style>

</head>
<body>

<div id="loginScreen" style="
position:fixed;
top:0;
left:0;
width:100%;
height:100%;
background:#000;
display:flex;
justify-content:center;
align-items:center;
z-index:9999;
">
  <div style="width:360px;background:#111;padding:30px;border-radius:20px;border:1px solid gold;">
    <h2 style="text-align:center;color:gold;">ğŸ” Tool Ve Chai Admin</h2>
    <input id="loginEmail" type="email" placeholder="Nháº­p Gmail"
    style="margin-top:15px;width:100%;padding:12px;border-radius:10px;border:none;background:#222;color:white;">
    <input id="loginPass" type="password" placeholder="Nháº­p Password"
    style="margin-top:10px;width:100%;padding:12px;border-radius:10px;border:none;background:#222;color:white;">
    <button onclick="secureLogin()" 
    style="margin-top:15px;width:100%;padding:12px;border-radius:10px;background:gold;font-weight:bold;">
      LOGIN
    </button>
    <div id="loginError" style="color:red;text-align:center;margin-top:10px;"></div>
  </div>
</div>

<div style="padding:20px;max-width:900px;margin:auto;">
  <h2>ğŸ›  Tool Ve Chai Check VIP</h2>

  <input id="q" placeholder="Nháº­p mÃ£ cáº§n kiá»ƒm tra"
    style="width:100%;padding:12px;border-radius:10px;margin-top:10px;">
  <button onclick="check()"
    style="width:100%;padding:12px;border-radius:10px;margin-top:10px;">
    CHECK
  </button>

 <div id="out" style="
  margin-top:20px;
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:15px;
"></div>

</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCEL7BDXvmNi2dp1VNpua7b2plpTiTOK3U",
  authDomain: "toolvechai.firebaseapp.com",
  projectId: "toolvechai"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();
const params = new URLSearchParams(window.location.search);
const userParam = params.get("u");

// Náº¿u cÃ³ ?u= thÃ¬ cháº¡y cháº¿ Ä‘á»™ USER
if(userParam){
  runUserMode(userParam);
}

async function runUserMode(id){

  try{

    const doc = await db.collection("shareLinks").doc(id).get();

    if(!doc.exists){
      document.body.innerHTML = "âŒ Link khÃ´ng tá»“n táº¡i!";
      return;
    }

    if(!doc.data().active){
      document.body.innerHTML = "ğŸ”’ Link Ä‘Ã£ bá»‹ khÃ³a!";
      return;
    }

    // Náº¿u há»£p lá»‡ â†’ bá» login screen hoÃ n toÃ n
    const loginScreen = document.getElementById("loginScreen");
    if(loginScreen) loginScreen.remove();

    // Táº¯t luÃ´n Firebase auth auto login
    auth.signOut();

  }catch(e){
    document.body.innerHTML = "âŒ Lá»—i quyá»n truy cáº­p!";
  }
}

async function checkUserAccess(id){

  try{
    const doc = await db.collection("shareLinks").doc(id).get();

    if(!doc.exists){
      document.body.innerHTML = "âŒ Link khÃ´ng tá»“n táº¡i!";
      return;
    }

    if(!doc.data().active){
      document.body.innerHTML = "ğŸ”’ Link Ä‘Ã£ bá»‹ khÃ³a!";
      return;
    }

  }catch(e){
    document.body.innerHTML = "âŒ Lá»—i quyá»n truy cáº­p!";
  }
}



auth.setPersistence(firebase.auth.Auth.Persistence.NONE);

// LOGIN
function secureLogin(){
  const email = document.getElementById("loginEmail").value;
  const pass = document.getElementById("loginPass").value;

  auth.signInWithEmailAndPassword(email, pass)
    .then(() => {
      document.getElementById("loginScreen").remove();
    })
    .catch(() => {
      document.getElementById("loginError").innerText = "Sai Gmail hoáº·c Password!";
    });
}

auth.onAuthStateChanged(function(user){
  if(user){
    document.getElementById("loginScreen").remove();
  }
});

// MAP MMC
const mmcMap={
 MMC1:"16G",MMC2:"32G",MMC3:"64G",
 MMC4:"128G",MMC5:"256G",MMC6:"512G"
};

// DETECT CHIP
function detectChip(code){
  code = code.toUpperCase();

  if(code.startsWith("KM")) return { name:"SAMSUNG", icon:"ğŸŸ¢" };
  if(code.startsWith("H")) return { name:"SK hynix", icon:"ğŸŸ£" };
  if(code.startsWith("JZ")) return { name:"MICRON", icon:"ğŸ”µ" };
  if(code.startsWith("THG")) return { name:"KIOXIA", icon:"ğŸŸ " };
  if(code.startsWith("SD")) return { name:"SANDISK", icon:"ğŸ”´" };

  return { name:"UNKNOWN / OEM", icon:"âšª" };
}

// CHECK (SEARCH 3 KÃ Tá»°)
async function check(){

  const q = document.getElementById("q");
  const out = document.getElementById("out");

  const key = q.value.toUpperCase().replace(/[^A-Z0-9]/g,"");
  out.innerHTML = "";

  if(key.length !== 3){
    out.innerHTML = "âš  Nháº­p Ä‘Ãºng 3 kÃ½ tá»±";
    return;
  }

  try{

    const prefixSnap = await db.collection("codes")
      .where("prefix3", "==", key)
      .get();

    const suffixSnap = await db.collection("codes")
      .where("suffix3", "==", key)
      .get();

    const results = new Map();

    prefixSnap.forEach(doc => {
      results.set(doc.id, doc.data());
    });

    suffixSnap.forEach(doc => {
      results.set(doc.id, doc.data());
    });

    if(results.size === 0){
      out.innerHTML = "âŒ KhÃ´ng xÃ¡c Ä‘á»‹nh mÃ£";
      return;
    }

    results.forEach(x => {

      const size = mmcMap[x.mmc] || "";
      const chip = detectChip(x.code);

      out.innerHTML += `
        <div class="item">
          <div style="font-weight:700;">âš¡ ${x.code}</div>
          <div class="badge">${chip.icon} ${chip.name}</div>
         ${x.mmc ? `<div class="badge mmc-badge">ğŸ’¾ ${x.mmc} (${size})</div>` : ""}
         ${x.vip ? `<div class="badge vip-${x.vip.replace(/\D/g,'')}">ğŸ‘‘ ${x.vip}</div>` : ""}

        </div>
      `;
    });

  }catch(e){
    out.innerHTML = "âŒ Lá»—i quyá»n truy cáº­p";
  }
}


 
</script>

</body>
</html>
